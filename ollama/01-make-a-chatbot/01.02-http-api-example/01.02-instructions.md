# 1 - Building a Chatbot

## 1.2 - AI, but in an API

We start out here with a desire to make this web facing. To do so, we'll use the FastAPI library (https://fastapi.tiangolo.com/). This will get us started making an API, fast. :-)

### Code Review

We start by importing the pieces of FastAPI that we'll need.

```python
from fastapi import FastAPI, Request
```

Then, we define the app as a FastAPI instance. We create a simple little helper function to make our code easier to read and expand on as we grow. Then we create a method linked to the `/chatbot` API endpoint, looking for a POST request. We're going to just directly hit that POSTed data and look for the question.

```python
app = FastAPI()

def ask_ollama(question: str) -> str:
    response = ollama.generate(model=MODEL_NAME, prompt=question)
    return response['response']


# Using Request object to get raw JSON
@app.post("/chatbot/")
async def chat(request: Request):
    data = await request.json()
    
    # Access the data directly
    question = data.get("question")
    
    return {
        "answer": ask_ollama(question),
        "question": question
    }

```

### Running It

Once you're in the ollama virtual environment we setup, you can run this with:

```bash
python 01.02-http-api-example.py
```

### Testing It

If you want to test is straight on, you can use cURL!

```bash
curl -X POST "http://localhost:8000/chatbot/" \
  -H "Content-Type: application/json" \
  -d '{"question": "What is the capital of France?"}'
```
or on Windows,
```cmd
curl -X POST "http://localhost:8000/chatbot/" -H "Content-Type: application/json" -d "{\"question\": \"What is the capital of France?\"}"
```

There is also an example of how to do this with the Python requests library supplied.

```bash
python 01.02-tester.py "What is the capital of Arizona?"
{'answer': 'The capital of Arizona is Phoenix.', 'question': 'What is the capital of Arizona?'}
```

### Summary

We were able to make our initial interface with Ollama something that we can expose via an API. First step to making a chatbot!
